{% extends "account/base.html" %}
{% load static %}

{% block title %}<title>Modifier les informations de {{ company.name }}</title>{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'company/company_form.css' %}">
<link rel="stylesheet" href="{% static 'auth/address-autocomplete.css' %}">

<a href="{% url 'company:company_detail' %}" class="back-button">
    <svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024">
        <path d="M874.690416 495.52477c0 11.2973-9.168824 20.466124-20.466124 20.466124l-604.773963 0 188.083679 188.083679c7.992021 7.992021 7.992021 20.947078 0 28.939099-4.001127 3.990894-9.240455 5.996574-14.46955 5.996574-5.239328 0-10.478655-1.995447-14.479783-5.996574l-223.00912-223.00912c-3.837398-3.837398-5.996574-9.046027-5.996574-14.46955 0-5.433756 2.159176-10.632151 5.996574-14.46955l223.019353-223.029586c7.992021-7.992021 20.957311-7.992021 28.949332 0 7.992021 8.002254 7.992021 20.957311 0 28.949332l-188.073446 188.073446 604.753497 0C865.521592 475.058646 874.690416 484.22707 874.690416 495.52477z"></path>
    </svg>
    Retour
</a>

<h2 class="album_name">Modifier les informations de l'entreprise</h2>

<div class="form-container">
    <form method="post">
        {% csrf_token %}

        <div class="form-section">
            <h4 class="form-title">Informations générales</h4>
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ form.name.id_for_label }}">Nom de l'entreprise</label>
                    {{ form.name }}
                    {% if form.name.errors %}
                        <div class="invalid-feedback">
                            {{ form.name.errors }}
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.category.id_for_label }}">Catégorie</label>
                    {{ form.category }}
                    {% if form.category.errors %}
                        <div class="invalid-feedback">
                            {{ form.category.errors }}
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <label for="{{ form.siret.id_for_label }}">Numéro SIRET</label>
                {{ form.siret }}
                {% if form.siret.errors %}
                    <div class="invalid-feedback">
                        {{ form.siret.errors }}
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="form-section">
            <h4 class="form-title">Adresse</h4>
            <div class="form-group">
                <label for="{{ form.address.id_for_label }}">Adresse</label>
                {{ form.address }}
                {% if form.address.errors %}
                    <div class="invalid-feedback">
                        {{ form.address.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="{{ form.postal_code.id_for_label }}">Code postal</label>
                    {{ form.postal_code }}
                    {% if form.postal_code.errors %}
                        <div class="invalid-feedback">
                            {{ form.postal_code.errors }}
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.city.id_for_label }}">Ville</label>
                    {{ form.city }}
                    {% if form.city.errors %}
                        <div class="invalid-feedback">
                            {{ form.city.errors }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <h4 class="form-title">Horaires d'ouverture</h4>
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ form.opening_hour.id_for_label }}">Heure d'ouverture</label>
                    {{ form.opening_hour }}
                    {% if form.opening_hour.errors %}
                        <div class="invalid-feedback">
                            {{ form.opening_hour.errors }}
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.closing_hour.id_for_label }}">Heure de fermeture</label>
                    {{ form.closing_hour }}
                    {% if form.closing_hour.errors %}
                        <div class="invalid-feedback">
                            {{ form.closing_hour.errors }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <h4 class="form-title">Localisation</h4>

            <!-- Recherche d'adresse -->
            <div class="form-group">
                <label for="{{ form.address_search.id_for_label }}">{{ form.address_search.label }}</label>
                {{ form.address_search }}
                <div id="autocomplete-results" class="autocomplete-results"></div>
                <small class="form-text">Recherchez une adresse pour localiser votre entreprise sur la carte.</small>
            </div>

            <p class="form-text">Vous pouvez également cliquer directement sur la carte pour définir l'emplacement précis de votre entreprise.</p>
            <div id="map-container" class="map-container"></div>

            <!-- Afficher les erreurs de validation pour les coordonnées -->
            {% if form.latitude.errors or form.longitude.errors %}
            <div class="location-error">
                Veuillez définir l'emplacement de votre entreprise sur la carte ou en utilisant la recherche d'adresse.
            </div>
            {% endif %}

            {{ form.latitude }}
            {{ form.longitude }}
        </div>

        <div class="btn-container">
            <button type="submit" class="btn-submit">Enregistrer les modifications</button>
            <a href="{% url 'company:company_detail' %}" class="btn-cancel">Annuler</a>
        </div>
    </form>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<script src="{% static 'auth/js/address-autocomplete.js' %}"></script>
{% endblock %}


