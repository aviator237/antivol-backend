{% extends "auth/base.html" %}
{% load static %}

{% block meta %}
<meta property="og:title" content="{{ title }}" />
<meta name="description" content="Page de création d'entreprise" />
<meta property="og:image" content="{% static 'images/logo_site_vie_reussie.jpeg' %}" />
<meta property="og:image:secure_url" content="{% static 'images/logo_site_vie_reussie.jpeg' %}" />
<meta property="og:image:alt" content="Le logo du site" />
{% endblock meta %}

{% block content %}
<link rel="stylesheet" href="{% static 'auth/register.css' %}">
<link rel="stylesheet" href="{% static 'auth/address-autocomplete.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<div class="form-div">
    {% if next %}
    <form class="form" method="post" action="{% url 'auth:company_create' uid %}?next={{ next }}">
    {% else %}
    <form class="form" method="post" action="{% url 'auth:company_create' uid %}">
    {% endif %}
        {% csrf_token %}
        <div class="title">
            <p>Création de compte entreprise</p>
            <p>Étape 2 : Informations de l'entreprise</p>
        </div>

        {{ form.name }}
        {{ form.category }}
        {{ form.siret }}

        <!-- Recherche d'adresse -->
        <div class="address-search-container">
            <label for="{{ form.address_search.id_for_label }}">{{ form.address_search.label }}</label>
            {{ form.address_search }}
            <div id="autocomplete-results" class="autocomplete-results"></div>
        </div>

        <!-- Adresse -->
        {{ form.address }}
        <div class="flex">
            {{ form.postal_code }}
            {{ form.city }}
        </div>

        <!-- Carte pour sélectionner l'emplacement -->
        <div class="location-section">
            <label>Emplacement de l'entreprise</label>
            <div id="map-container" class="map-container"></div>
            <p class="map-help">Cliquez sur la carte pour définir l'emplacement précis de votre entreprise ou utilisez la recherche d'adresse ci-dessus.</p>

            <!-- Afficher les erreurs de validation pour les coordonnées -->
            {% if form.latitude.errors or form.longitude.errors %}
            <div class="location-error">
                Veuillez définir l'emplacement de votre entreprise sur la carte ou en utilisant la recherche d'adresse.
            </div>
            {% endif %}
        </div>

        <!-- Champs cachés pour les coordonnées GPS -->
        {{ form.latitude }}
        {{ form.longitude }}

        <!-- Heures d'ouverture et de fermeture -->
        <div class="flex">
            <div class="time-field">
                <label for="{{ form.opening_hour.id_for_label }}">Heure d'ouverture</label>
                {{ form.opening_hour }}
            </div>
            <div class="time-field">
                <label for="{{ form.closing_hour.id_for_label }}">Heure de fermeture</label>
                {{ form.closing_hour }}
            </div>
        </div>

        <button class="submit">Créer mon entreprise</button>
    </form>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<script src="{% static 'auth/js/address-autocomplete.js' %}"></script>
{% endblock %}
